% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/clean.R
\name{ms_clean}
\alias{ms_clean}
\title{Clean geometries using mapshaper}
\usage{
ms_clean(
  input,
  gap_fill_area = NULL,
  sliver_control = 1,
  overlap_rule = "max-area",
  allow_overlaps = FALSE,
  snap_interval = NULL,
  rewind = FALSE,
  allow_empty = FALSE,
  ...
)
}
\arguments{
\item{input}{spatial object to clean. One of:
\itemize{
\item \code{geo_json} or \code{character} polygons, lines, or points;
\item \code{SpatialPolygons*}, \code{SpatialLines*}, or \code{SpatialPoints*};
\item \code{sf} or \code{sfc} polygons, lines, or points object
}}

\item{gap_fill_area}{(polygons) Gaps smaller than this area will be filled;
larger gaps will be retained as holes in the polygon mosaic. Numeric value
in source units. Default \code{NULL} uses mapshaper's dynamic calculation.}

\item{sliver_control}{(polygons) Preferentially remove slivers (polygons with
a high perimeter-area ratio). Accepts values from 0-1, default is 1.
Multiplies the area of gap areas by the "Polsby Popper" compactness metric
before applying area threshold.}

\item{overlap_rule}{(polygons) Assign overlapping polygon areas to one of the
overlapping features based on this rule. One of: "min-id", "max-id",
"min-area", "max-area". Default is "max-area".}

\item{allow_overlaps}{Allow features to overlap each other. The default
behavior is to remove overlaps (default \code{FALSE}).}

\item{snap_interval}{Snap vertices within a given threshold before performing
other kinds of geometry repair. Defaults to a very small threshold. Uses
source units. Default \code{NULL}.}

\item{rewind}{Fix errors in the winding order of polygon rings (default
\code{FALSE}).}

\item{allow_empty}{Allow null geometries, which are removed by default
(default \code{FALSE}).}

\item{...}{
  Arguments passed on to \code{\link[=apply_mapshaper_commands]{apply_mapshaper_commands}}
  \describe{
    \item{\code{force_FC}}{should the output be forced to be a FeatureCollection (or sf
object or Spatial*DataFrame) even if there are no attributes? Default
\code{TRUE}. If FALSE and there are no attributes associated with the
geometries, a GeometryCollection (or Spatial object with no dataframe, or
sfc) will be output.}
    \item{\code{sys}}{Should the system mapshaper be used instead of the bundled
mapshaper? Gives better performance on large files. Requires the mapshaper
node package to be installed and on the PATH.}
    \item{\code{sys_mem}}{How much memory (in GB) should be allocated if using the
system mapshaper (\code{sys = TRUE})? Default 8. Ignored if \code{sys = FALSE}. This
can also be set globally with the option \code{"mapshaper.sys_mem"}}
    \item{\code{quiet}}{If \code{sys = TRUE}, should the mapshaper messages be silenced?
Default \code{FALSE}. This can also be set globally with the option
\code{"mapshaper.sys_quiet"}}
    \item{\code{gj2008}}{Generate output that is consistent with the pre-RFC 7946
GeoJSON spec (dating to 2008). Polygon rings are CW and holes are CCW,
which is the opposite of the default RFC 7946-compatible output. This should
be rarely needed, though may be useful when preparing data for D3-based
data visualizations (such as \code{plotly::plot_ly()}). Default \code{FALSE}}
  }}
}
\value{
a cleaned representation of the geometry in the same class as the
input
}
\description{
Uses \href{https://github.com/mbloch/mapshaper}{mapshaper} to clean
geometries by removing overlaps, filling gaps, and repairing various kinds
of abnormal geometry.
}
\details{
Features with null geometries are deleted, unless the \code{allow_empty} flag
is used.

Polygon features are cleaned by removing overlaps and filling small gaps
between adjacent polygons. Only gaps that are completely enclosed can be
filled. Areas that are contained by more than one polygon (overlaps) are
assigned to the polygon with the largest area by default. Similarly, gaps are
assigned to the largest-area polygon.

Line features are cleaned by removing self-intersections within the same path.
Self-intersecting paths are split at the point of intersection and converted
into multiple paths within the same feature. When two separate paths intersect
in-between segment endpoints, new vertices are inserted at the point of
intersection.

Point features are cleaned by removing duplicate coordinates within the same
feature.
}
\examples{
library(rmapshaper)

# Example with overlapping polygons
overlapping_poly <- structure('{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {"id": 1},
      "geometry": {
        "type": "Polygon",
        "coordinates": [[[0, 0], [2, 0], [2, 2], [0, 2], [0, 0]]]
      }
    },
    {
      "type": "Feature", 
      "properties": {"id": 2},
      "geometry": {
        "type": "Polygon",
        "coordinates": [[[1, 1], [3, 1], [3, 3], [1, 3], [1, 1]]]
      }
    }
  ]
}', class = c("geojson", "json"))

# Clean overlapping polygons
ms_clean(overlapping_poly)

# Clean with specific overlap rule
ms_clean(overlapping_poly, overlap_rule = "min-area")

}
